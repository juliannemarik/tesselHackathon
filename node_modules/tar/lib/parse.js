function e(){var n=this;if(!(n instanceof e))return new e;t.apply(n),n.writable=!0,n.readable=!0,n._stream=new r(512),n.position=0,n._ended=!1,n._stream.on("error",function(e){n.emit("error",e)}),n._stream.on("data",function(e){n._process(e)}),n._stream.on("end",function(){n._streamEnd()}),n._stream.on("drain",function(){n.emit("drain")})}module.exports=e.create=e;var t=require("stream").Stream,r=require("block-stream"),n=require("../tar.js"),i=require("./header.js"),s=require("./entry.js"),a=require("./buffer-entry.js"),o=require("./extended-header.js"),d=require("assert").ok;require("inherits")(e,require("fstream").Reader),e.prototype._streamEnd=function(){this._ended||this.error("unexpected eof"),this.emit("end")},e.prototype.write=function(e){if(!this._ended)return this._stream.write(e);for(var t=0,r=e.length;t>r;t++)if(0!==e[t])return this.error("write() after end()")},e.prototype.end=function(e){return this._ended=!0,this._stream.end(e)},e.prototype._read=function(){},e.prototype._process=function(e){var t,r,n;if(d(e&&512===e.length,"block size should be 512"),this._entry)(t=this._entry).write(e),0===t._remaining&&(t.end(),this._entry=null);else{for(r=!0,n=0;n<512&&r;n++)r=0===e[n];r?(this._eofStarted&&(this._ended=!0),this._eofStarted=!0):(this._eofStarted=!1,this._startEntry(e))}this.position+=512},e.prototype._startEntry=function(e){var t,r,d,l,c,u,h,_,f=new i(e),p=this,m=!1;switch(null!==f.size&&f.cksumValid||((c=Error("invalid tar file")).header=f,c.tar_file_offset=this.position,c.tar_block=this.position/512,this.emit("error",c)),n.types[f.type]){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":d=s,r="entry";break;case"GlobalExtendedHeader":d=o,l=function(){p._global=p._global||{},Object.keys(t.fields).forEach(function(e){p._global[e]=t.fields[e]})},r="globalExtendedHeader",m=!0;break;case"ExtendedHeader":case"OldExtendedHeader":d=o,l=function(){p._extended=t.fields},r="extendedHeader",m=!0;break;case"NextFileHasLongLinkpath":d=a,l=function(){p._extended=p._extended||{},p._extended.linkpath=t.body},r="longLinkpath",m=!0;break;case"NextFileHasLongPath":case"OldGnuLongPath":d=a,l=function(){p._extended=p._extended||{},p._extended.path=t.body},r="longPath",m=!0;break;default:d=s,r="ignoredEntry"}m?u=h=null:(u=this._global,h=this._extended,this._extended=null),(t=new d(f,h,u)).meta=m,m||t.on("data",function(e){_.emit("data",e)}),l&&t.on("end",l),this._entry=t,_=this,t.on("pause",function(){_.pause()}),t.on("resume",function(){_.resume()}),this.listeners("*").length&&this.emit("*",r,t),this.emit(r,t),0===t.props.size&&(t.end(),this._entry=null)};