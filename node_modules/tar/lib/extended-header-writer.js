function e(t){var i;if(!(this instanceof e))return new e(t);this.fields=t,i={path:("PaxHeader"+n.join("/",t.path||"")).replace(/\\/g,"/").substr(0,100),mode:t.mode||438,uid:t.uid||0,gid:t.gid||0,size:0,mtime:t.mtime||Date.now()/1e3,type:"x",linkpath:"",ustar:"ustar\0",ustarver:"00",uname:t.uname||"",gname:t.gname||"",devmaj:t.devmaj||0,devmin:t.devmin||0},r.call(this,i),this.props=i,this._meta=!0}function t(e,r,n,s){return Object.keys(e).forEach(function(a){var o=e[a];if(i.numeric[a],r&&(a=r+"."+a),a!==e.type||!0!==o){switch(a){case"mode":case"cksum":case"ustar":case"ustarver":case"prefix":case"basename":case"dirname":case"needExtended":case"block":case"filter":return;case"rdev":if(0===o)return;break;case"nlink":case"dev":case"ino":a="SCHILY."+a}if(o&&"object"==typeof o&&!Buffer.isBuffer(o))t(o,a,n,s);else{if(null===o||void 0===o)return;n.push.apply(n,function(e,t,r){var n,s,a,o,d;if(e.charAt(0)===e.charAt(0).toLowerCase()&&(n=e.split(".")[0],i.knownExtended[n]||(e="NODETAR."+e)),r&&e.charAt(0)!==e.charAt(0).toLowerCase())return[];if("number"==typeof val&&(val=val.toString(10)),s=new Buffer(" "+e+"="+t+"\n"),a=Math.floor(Math.log(s.length)/Math.log(10))+1,s.length+a>=Math.pow(10,a)&&(a+=1),o=a+s.length,(d=new Buffer(""+o)).length+s.length!==o)throw Error("Bad length calculation\nlen="+o+"\nlenBuf="+JSON.stringify(""+d)+"\nlenBuf.length="+d.length+"\ndigits="+a+"\ns="+JSON.stringify(""+s)+"\ns.length="+s.length);return[d,s]}(a,o,s))}}}),n}var r,i,n,s;module.exports=e,require("inherits")(e,r=require("./entry-writer.js")),i=require("../tar.js"),n=require("path"),s=require("./header.js"),e.prototype.end=function(){var e=this;if(!e._ended){if(e._ended=!0,e._encodeFields(),0===e.props.size)return e._ready=!0,void e._stream.end();e._stream.write(s.encode(e.props)),e.body.forEach(function(t){e._stream.write(t)}),e._ready=!0,this._stream.end()}},e.prototype._encodeFields=function(){this.body=[],this.fields.prefix&&(this.fields.path=this.fields.prefix+"/"+this.fields.path,this.fields.prefix=""),t(this.fields,"",this.body,this.fields.noProprietary);var e=this;this.body.forEach(function(t){e.props.size+=t.length})};