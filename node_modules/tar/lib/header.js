function e(t){if(!(this instanceof e))return new e(t);t&&this.decode(t)}function t(t){var f,s,p,d,g,b,x,w,y,v,S,B,E,j,N;if(!(t||this instanceof e))throw Error("encode must be called on a TarHeader, or supplied an object");for(f=(t=t||this).block=new Buffer(512),t.prefix&&(t.path=t.prefix+"/"+t.path,t.prefix=""),t.needExtended=!1,t.mode&&("string"==typeof t.mode&&(t.mode=parseInt(t.mode,8)),t.mode=511&t.mode),s=0;null!==u[s];s++){switch(p=u[s],d=c[s],g=a[s],p){case"cksum":case"prefix":break;case"type":(x=t.type||"0").length>1&&((x=o.types[t.type])||(x="0")),i(f,d,g,x);break;case"path":if(w=Buffer.byteLength(t.path),y=l[u.path],v=l[u.prefix],w>y&&w<=y+v){for(S=w-1-y,B=v,E=!1,j=new Buffer(t.path),N=S;N<=B;N++)if(j[N]===m||j[N]===k){E=N;break}if(!1!==E){prefix=j.slice(0,E).toString("utf8"),path=j.slice(E+1).toString("utf8"),b=i(f,d,g,path),b=i(f,d=c[u.prefix],g=a[u.prefix],prefix)||b;break}}i(f,c[u.prefix],a[u.prefix],"");default:b=h[p]?r(f,d,g,t[p]):i(f,d,g,t[p]||"")}t.needExtended=t.needExtended||b}return d=c[u.cksum],g=a[u.cksum],r(f,d,g,n.call(this,f)),f}function r(e,t,r,i){var n,f=r-t,s=g[f]||0;if(((i=i||0)instanceof Date||"[object Date]"===Object.prototype.toString.call(i))&&(i=i.getTime()/1e3),i>s||i<0)return function(t,r,i,n){var f,s,o,u,c,a,l,h=e.slice(r,i),p=n>=0;h[0]=p?128:255,p||(n*=-1),f=[];do{s=n%256,f.push(s),n=(n-s)/256}while(n);for(o=f.length,u=h.length-o,c=1;c<u;c++)h[c]=p?0:255;for(a=!0,c=o;c>0;c--)l=f[o-c],p?h[u+c]=l:a&&0===l?h[u+c]=0:a?(a=!1,h[u+c]=256-l):h[u+c]=255-l}(0,t,r,i),!0;if(n=Math.floor(i).toString(8),i<g[f-1]&&(n+=" "),n.length<f&&(n=Array(f-n.length).join("0")+n),n.length!==f-1)throw Error("invalid length: "+JSON.stringify(n)+"\nexpected: "+f);e.write(n,t,f,"utf8"),e[r-1]=0}function i(e,t,r,i){var n,f=Buffer.byteLength(i),s=Math.min(f,r-t),o=f!==i.length||f>s;for(s>0&&e.write(i,t,s,"utf8"),n=t+s;n<r;n++)e[n]=0;return o}function n(e){var t,r,i,n;if(e=e||this.block,p(Buffer.isBuffer(e)&&512===e.length),!e)throw Error("Need block to checksum");for(t=0,r=c[u.cksum],i=a[u.cksum],n=0;n<c[u.cksum];n++)t+=e[n];for(n=r;n<i;n++)t+=d;for(n=i;n<512;n++)t+=e[n];return t}function f(e){var t,r,i,n,f,o;for(e=e||this.block,p(Buffer.isBuffer(e)&&512===e.length),this.block=e,this.cksumValid=this.checkSum(),t=null,r=0;null!==u[r];r++)switch(i=u[r],n=e.slice(c[r],a[r]),i){case"ustar":if(""+n!="ustar\0")return void(this.ustar=!1);this.ustar=""+n;break;case"prefix":f=s(n.slice(131,143)),o=s(n.slice(143,155)),0!==n[130]&&n[130]!==d||"number"!=typeof f||"number"!=typeof o||n[143]!==d||n[155]!==d||(this.atime=f,this.ctime=o,n=n.slice(0,130)),t=n.toString("utf8").replace(/\0+$/,"");break;default:h[i]?this[i]=s(n):this[i]=n.toString("utf8").replace(/\0+$/,"")}t&&(this.path=t+"/"+this.path)}function s(e){if(128&e[0])return function(e){var t,r,i,n,f,s,o;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}for(r=!1,i=[],n=e.length-1;n>0;n--)f=e[n],t?i.push(f):r&&0===f?i.push(0):r?(r=!1,i.push(256-f)):i.push(255-f);for(s=0,n=0,o=i.length;n<o;n++)s+=i[n]*Math.pow(256,n);return t?s:-1*s}(e);var t=e.toString("utf8").split("\0")[0].trim(),r=parseInt(t,8);return isNaN(r)?null:r}var o,u,c,a,l,h,p,d,m,k,g;module.exports=e,o=require("../tar.js"),u=o.fields,c=o.fieldOffs,a=o.fieldEnds,l=o.fieldSize,h=o.numeric,p=require("assert").ok,d=32,m=47,k="win32"===process.platform?92:null,e.prototype={decode:f,encode:t,calcSum:n,checkSum:function(e){var t,r=n.call(this,e);return e=e||this.block,t=e.slice(c[u.cksum],a[u.cksum]),(t=s(t))===r}},e.parseNumeric=s,e.encode=t,e.decode=f,g={12:8589934591,11:1073741823,8:2097151,7:262143};