function e(t){var r=this;if(!(r instanceof e))return new e(t);n.apply(this),r.writable=!0,r.readable=!0,r._stream=new s(512),r._stream.on("data",function(e){r.emit("data",e)}),r._stream.on("drain",function(){r.emit("drain")}),r._stream.on("end",function(){r.emit("end"),r.emit("close")}),r.props=t,"Directory"===t.type&&(t.size=0),t.ustar="ustar\0",t.ustarver="00",r.path=t.path,r._buffer=[],r._didHeader=!1,r._meta=!1,r.on("pipe",function(){r._process()})}module.exports=e,require("../tar.js");var t,r=require("./header.js"),i=(require("./entry.js"),require("inherits")),s=require("block-stream"),n=require("stream").Stream,o={};i(e,n),e.prototype.write=function(e){return this._ended?this.emit("error",Error("write after end")):(this._buffer.push(e),this._process(),this._needDrain=this._buffer.length>0,!this._needDrain)},e.prototype.end=function(e){e&&this._buffer.push(e),this._buffer.push(o),this._ended=!0,this._process(),this._needDrain=this._buffer.length>0},e.prototype.pause=function(){this._paused=!0,this.emit("pause")},e.prototype.resume=function(){this._paused=!1,this.emit("resume"),this._process()},e.prototype.add=function(e){return this.parent?(this._ended||this.end(),this.parent.add(e)):this.emit("error",Error("no parent"))},e.prototype._header=function(){var e,i;this._didHeader||(this._didHeader=!0,e=r.encode(this.props),this.props.needExtended&&!this._meta&&(i=this,(t=t||require("./extended-header-writer.js"))(this.props).on("data",function(e){i.emit("data",e)}).on("error",function(e){i.emit("error",e)}).end()),this.emit("data",e),this.emit("header"))},e.prototype._process=function(){var e,t,r;if(this._didHeader||this._meta||this._header(),!this._paused&&!this._processing){for(this._processing=!0,e=this._buffer,t=0;t<e.length;t++)if((r=e[t])===o?this._stream.end():this._stream.write(r),this._paused)return this._processing=!1,void(t<e.length&&(this._needDrain=!0,this._buffer=e.slice(t+1)));this._buffer.length=0,this._processing=!1,this.emit("drain")}},e.prototype.destroy=function(){};