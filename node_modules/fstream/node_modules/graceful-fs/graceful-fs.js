function t(){}function o(t,o,n,s){this.path=t,this.flags=o,this.mode=n,this.cb=s,e.call(this)}function n(t,o){this.path=t,this.cb=o,e.call(this)}function e(){this.done=this.done.bind(this),this.failures=0,this.process()}function s(){var t=h.shift();t&&(c("process",t.constructor.name,t),t.process())}var i,c,r,f,l,p,u,h,a=module.exports=require("./fs.js"),d=require("assert");require("./polyfills.js"),i=require("util"),c=t,i.debuglog?c=i.debuglog("gfs"):/\bgfs\b/i.test(process.env.NODE_DEBUG||"")&&(c=function(){var t=i.format.apply(i,arguments);t="GFS: "+t.split(/\n/).join("\nGFS: "),console.error(t)}),/\bgfs\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){c("fds",f),c(h),d.equal(h.length,0)}),r=a.open,a.open=function(n,e,s,i){"function"==typeof s&&(i=s,s=null),"function"!=typeof i&&(i=t),new o(n,e,s,i)},i.inherits(o,e),o.prototype.process=function(){r.call(a,this.path,this.flags,this.mode,this.done)},f={},o.prototype.done=function(t,o){c("open done",t,o),o&&(f["fd"+o]=this.path),e.prototype.done.call(this,t,o)},l=a.readdir,a.readdir=function(o,e){"function"!=typeof e&&(e=t),new n(o,e)},i.inherits(n,e),n.prototype.process=function(){l.call(a,this.path,this.done)},n.prototype.done=function(t,o){o&&o.sort&&(o=o.sort()),e.prototype.done.call(this,t,o),s()},p=a.close,a.close=function(o,n){c("close",o),"function"!=typeof n&&(n=t),delete f["fd"+o],p.call(a,o,function(t){s(),n(t)})},u=a.closeSync,a.closeSync=function(t){try{return u(t)}finally{s()}},e.prototype.done=function(t,o){var n,e=!1;t&&(e="EMFILE"===(n=t.code)||"ENFILE"===n,"win32"===process.platform&&(e=e||"OK"===n)),e?(this.failures++,function(t){h.push(t),c("enqueue %d %s",h.length,t.constructor.name,t)}(this)):(0,this.cb)(t,o)},h=[];