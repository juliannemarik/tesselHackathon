function e(t,r){var i,o,n=this;switch("string"==typeof t&&(t={path:t}),t.path||n.error("Must provide a path",null,!0),i=d(t),o=e,i){case"Directory":o=h;break;case"File":o=_;break;case"Link":case"SymbolicLink":o=y;break;case null:o=b}if(!(n instanceof o))return new o(t);m.call(n),n.type=t.type,n.props=t,n.depth=t.depth||0,n.clobber=!1!==t.clobber||t.clobber,n.parent=t.parent||null,n.root=t.root||t.parent&&t.parent.root||n,n._path=n.path=f.resolve(t.path),"win32"===process.platform&&(n.path=n._path=n.path.replace(/\?/g,"_"),n._path.length>=260&&(n._swallowErrors=!0,n._path="\\\\?\\"+n.path.replace(/\//g,"\\"))),n.basename=f.basename(t.path),n.dirname=f.dirname(t.path),n.linkpath=t.linkpath||null,t.parent=t.root=null,n.size=t.size,"string"==typeof t.mode&&(t.mode=parseInt(t.mode,8)),n.readable=!1,n.writable=!0,n._buffer=[],n.ready=!1,n.filter="function"==typeof t.filter?t.filter:null,n._stat(r)}function t(t){s(f.dirname(t._path),e.dirmode,function(e,r){return e?t.error(e):(t._madeDir=r,t._create())})}function r(e,t,r,i,o){var n,a=t.mode,u=t.follow||"SymbolicLink"!==e.type?"chmod":"lchmod";return p[u]?"number"!=typeof a?o():(n=511&r.mode,(a&=511)===n?o():void p[u](i,a,o)):o()}function i(e,t,r,i,o){if("win32"===process.platform)return o();if(!process.getuid||0===!process.getuid())return o();if("number"!=typeof t.uid&&"number"!=typeof t.gid)return o();if(r.uid===t.uid&&r.gid===t.gid)return o();var n=e.props.follow||"SymbolicLink"!==e.type?"chown":"lchown";if(!p[n])return o();"number"!=typeof t.uid&&(t.uid=r.uid),"number"!=typeof t.gid&&(t.gid=r.gid),p[n](i,t.uid,t.gid,o)}function o(e,t,r,i,o){var n,u,l,s,f;return p.utimes&&"win32"!==process.platform?("lutimes"!=(n=t.follow||"SymbolicLink"!==e.type?"utimes":"lutimes")||p[n]||(n="utimes"),p[n]?(u=r.atime,l=r.mtime,s=t.atime,f=t.mtime,void 0===s&&(s=u),void 0===f&&(f=l),a(s)||(s=new Date(s)),a(f)||(s=new Date(f)),s.getTime()===u.getTime()&&f.getTime()===l.getTime()?o():void p[n](i,s,f,o)):o()):o()}function n(e,t,a){var u=e._madeDir,l=f.dirname(t);!function(e,t,n){function a(e){if(!l)return e?n(l=e):0==--u?n():void 0}var u,l,s={};Object.keys(e.props).forEach(function(t){s[t]=e.props[t],"mode"===t&&"Directory"!==e.type&&(s[t]=73|s[t])}),u=3,l=null,p.stat(t,function(p,u){if(p)return n(l=p);r(e,s,u,t,a),i(e,s,u,t,a),o(e,s,u,t,a)})}(e,l,function(t){return t?a(t):l===u?a():void n(e,l,a)})}function a(e){return"object"==typeof e&&"[object Date]"===function(e){return Object.prototype.toString.call(e)}(e)}var p,u,l,s,f,c,d,m,h,y,_,b;module.exports=e,p=require("graceful-fs"),u=require("inherits"),l=require("rimraf"),s=require("mkdirp"),f=require("path"),c="win32"===process.platform?0:process.umask(),d=require("./get-type.js"),u(e,m=require("./abstract.js")),e.dirmode=511&~c,e.filemode=438&~c,h=require("./dir-writer.js"),y=require("./link-writer.js"),_=require("./file-writer.js"),b=require("./proxy-writer.js"),e.prototype._create=function(){var e=this;p[e.props.follow?"stat":"lstat"](e._path,function(t){if(t)return e.warn("Cannot create "+e._path+"\nUnsupported type: "+e.type,"ENOTSUP");e._finish()})},e.prototype._stat=function(e){function r(e,r){return i.filter&&!i.filter.call(n,n,r)?(i._aborted=!0,i.emit("end"),void i.emit("close")):e||!r?t(i):(i._old=r,d(r)!==i.type?l(i._path,function(e){if(e)return i.error(e);i._old=null,t(i)}):void t(i))}var i=this,o=i.props.follow?"stat":"lstat",n=i._proxy||i;e?r(null,e):p[o](i._path,r)},e.prototype._finish=function(){function e(e){l+=3,r(u,u.props,e,u._path,t("chmod")),i(u,u.props,e,u._path,t("chown")),o(u,u.props,e,u._path,t("utimes"))}function t(e){return function(t){function r(e){if(e)return e.fstream_finish_call="setupMadeDir",u.error(e);u.emit("end"),u.emit("close")}if(!s){if(t)return t.fstream_finish_call=e,u.error(s=t);if(!(--l>0||f)){if(f=!0,!u._madeDir)return r();n(u,u._path,r)}}}}var a,u=this,l=0,s=null,f=!1;u._old?(u._old.atime=new Date(0),u._old.mtime=new Date(0),e(u._old)):(a=u.props.follow?"stat":"lstat",p[a](u._path,function(t,r){if(t)return"ENOENT"!==t.code||"Link"!==u.type&&"SymbolicLink"!==u.type||"win32"!==process.platform?u.error(t):(u.ready=!0,u.emit("ready"),u.emit("end"),u.emit("close"),void(u.end=u._finish=function(){}));e(u._old=r)}))},e.prototype.pipe=function(){this.error("Can't pipe from writable stream")},e.prototype.add=function(){this.error("Cannot add to non-Directory type")},e.prototype.write=function(){return!0};