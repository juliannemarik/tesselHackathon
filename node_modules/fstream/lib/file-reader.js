function e(t){if(!(this instanceof e))throw Error("FileReader must be called as constructor.");if(!("Link"===t.type&&t.Link||"File"===t.type&&t.File))throw Error("Non-file type "+t.type);this._buffer=[],this._bytesEmitted=0,r.call(this,t)}module.exports=e;var t=require("graceful-fs"),r=require("../fstream.js").Reader,i=require("inherits"),s=(require("mkdirp"),{EOF:!0}),u={CLOSE:!0};i(e,r=require("./reader.js")),e.prototype._getStream=function(){var e=this,r=e._stream=t.createReadStream(e._path,e.props);e.props.blksize&&(r.bufferSize=e.props.blksize),r.on("open",e.emit.bind(e,"open")),r.on("data",function(t){e._bytesEmitted+=t.length,t.length&&(e._paused||e._buffer.length?(e._buffer.push(t),e._read()):e.emit("data",t))}),r.on("end",function(){e._paused||e._buffer.length?(e._buffer.push(s),e._read()):e.emit("end"),e._bytesEmitted!==e.props.size&&e.error("Didn't get expected byte count\nexpect: "+e.props.size+"\nactual: "+e._bytesEmitted)}),r.on("close",function(){e._paused||e._buffer.length?(e._buffer.push(u),e._read()):e.emit("close")}),e._read()},e.prototype._read=function(){var e,t,r,i,a=this;if(!a._paused){if(!a._stream)return a._getStream();if(a._buffer.length){for(t=0,r=(e=a._buffer).length;t<r;t++)if((i=e[t])===s?a.emit("end"):i===u?a.emit("close"):a.emit("data",i),a._paused)return void(a._buffer=e.slice(t));a._buffer.length=0}}},e.prototype.pause=function(e){this._paused||(e=e||this,this._paused=!0,this._stream&&this._stream.pause(),this.emit("pause",e))},e.prototype.resume=function(e){this._paused&&(e=e||this,this.emit("resume",e),this._paused=!1,this._stream&&this._stream.resume(),this._read())};