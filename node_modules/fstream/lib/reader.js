function e(r,a){var i,p,f=this;if(!(f instanceof e))return new e(r,a);switch("string"==typeof r&&(r={path:r}),r.path||f.error("Must provide a path",null,!0),r.type&&"function"==typeof r.type?p=i=r.type:(i=o(r),p=e),a&&!i&&(r[i=o(a)]=!0,r.type=i),i){case"Directory":p=u;break;case"Link":case"File":p=l;break;case"SymbolicLink":p=h;break;case"Socket":p=c;break;case null:p=d}if(!(f instanceof p))return new p(r);n.call(f),f.readable=!0,f.writable=!1,f.type=i,f.props=r,f.depth=r.depth=r.depth||0,f.parent=r.parent||null,f.root=r.root||r.parent&&r.parent.root||f,f._path=f.path=s.resolve(r.path),"win32"===process.platform&&(f.path=f._path=f.path.replace(/\?/g,"_"),f._path.length>=260&&(f._swallowErrors=!0,f._path="\\\\?\\"+f.path.replace(/\//g,"\\"))),f.basename=r.basename=s.basename(f.path),f.dirname=r.dirname=s.dirname(f.path),r.parent=r.root=null,f.size=r.size,f.filter="function"==typeof r.filter?r.filter:null,"alpha"===r.sort&&(r.sort=t),f._stat(a)}function t(e,t){return e===t?0:e.toLowerCase()>t.toLowerCase()?1:e.toLowerCase()<t.toLowerCase()?-1:e>t?1:-1}var r,a,i,s,o,p,n,u,l,h,c,d;module.exports=e,r=require("graceful-fs"),a=require("stream").Stream,i=require("inherits"),s=require("path"),o=require("./get-type.js"),p=e.hardLinks={},i(e,n=require("./abstract.js")),u=require("./dir-reader.js"),l=require("./file-reader.js"),h=require("./link-reader.js"),c=require("./socket-reader.js"),d=require("./proxy-reader.js"),e.prototype._stat=function(e){function t(e,t){var r,s,n,u,l;return e?a.error(e):(Object.keys(t).forEach(function(e){i[e]=t[e]}),void 0!==a.size&&i.size!==a.size?a.error("incorrect size"):(a.size=i.size,r=o(i),!1!==i.hardlinks&&"Directory"!==r&&i.nlink&&i.nlink>1&&(s=i.dev+":"+i.ino,p[s]!==a._path&&p[s]?(r=a.type=a.props.type="Link",a.Link=a.props.Link=!0,a.linkpath=a.props.linkpath=p[s],a._stat=a._read=h.prototype._read):p[s]=a._path),a.type&&a.type!==r&&a.error("Unexpected type: "+r),void(!a.filter||(n=a._proxy||a,a.filter.call(n,n,i))?(u=["_stat","stat","ready"],l=0,function e(){if(a._aborted)return a.emit("end"),void a.emit("close");if(a._paused&&"Directory"!==a.type)a.once("resume",e);else{var t=u[l++];if(!t)return a._read();a.emit(t,i),e()}}()):a._disowned||(a.abort(),a.emit("end"),a.emit("close")))))}var a=this,i=a.props,s=i.follow?"stat":"lstat";e?process.nextTick(t.bind(null,null,e)):r[s](a._path,t)},e.prototype.pipe=function(e){var t=this;return"function"==typeof e.add&&t.on("entry",function(r){!1===e.add(r)&&t.pause()}),a.prototype.pipe.apply(this,arguments)},e.prototype.pause=function(e){this._paused=!0,e=e||this,this.emit("pause",e),this._stream&&this._stream.pause(e)},e.prototype.resume=function(e){this._paused=!1,e=e||this,this.emit("resume",e),this._stream&&this._stream.resume(e),this._read()},e.prototype._read=function(){this.error("Cannot read unknown type: "+this.type)};