function r(e){if(!(this instanceof r))throw Error("ProxyWriter must be called as constructor.");this.props=e,this._needDrain=!1,t.call(this,e)}module.exports=r;var t=require("./writer.js"),e=require("./get-type.js"),i=require("inherits"),o=require("./collect.js"),n=require("fs");i(r,t),r.prototype._stat=function(){var r=this,i=r.props,o=i.follow?"stat":"lstat";n[o](i.path,function(o,n){var s;s=o||!n?"File":e(n),i[s]=!0,i.type=r.type=s,r._old=n,r._addProxy(t(i,n))})},r.prototype._addProxy=function(r){var t=this;if(t._proxy)return t.error("proxy already set");t._proxy=r,["ready","error","close","pipe","drain","warn"].forEach(function(e){r.on(e,t.emit.bind(t,e))}),t.emit("proxy",r),t._buffer.forEach(function(t){r[t[0]].apply(r,t[1])}),t._buffer.length=0,t._needsDrain&&t.emit("drain")},r.prototype.add=function(r){return o(r),this._proxy?this._proxy.add(r):(this._buffer.push(["add",[r]]),this._needDrain=!0,!1)},r.prototype.write=function(r){return this._proxy?this._proxy.write(r):(this._buffer.push(["write",[r]]),this._needDrain=!0,!1)},r.prototype.end=function(r){return this._proxy?this._proxy.end(r):(this._buffer.push(["end",[r]]),!1)};