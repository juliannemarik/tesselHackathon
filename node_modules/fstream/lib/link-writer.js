function i(e){if(!(this instanceof i))throw Error("LinkWriter must be called as constructor.");if(!("Link"===e.type&&e.Link||"SymbolicLink"===e.type&&e.SymbolicLink))throw Error("Non-link type "+e.type);""===e.linkpath&&(e.linkpath="."),e.linkpath||this.error("Need linkpath property to create "+e.type),n.call(this,e)}function e(i,e,n){f(i._path,function(o){if(o)return i.error(o);!function(i,e){t[n](e,i._path,function(e){if(e){if("ENOENT"!==e.code&&"EACCES"!==e.code&&"EPERM"!==e.code||"win32"!==process.platform)return i.error(e);i.ready=!0,i.emit("ready"),i.emit("end"),i.emit("close"),i.end=i._finish=function(){}}r(i)})}(i,e)})}function r(i){i.ready=!0,i.emit("ready"),i._ended&&!i._finished&&i._finish()}module.exports=i;var t=require("graceful-fs"),n=require("./writer.js"),o=require("inherits"),a=require("path"),f=require("rimraf");o(i,n),i.prototype._create=function(){var i=this,n="Link"===i.type||"win32"===process.platform,o=n?"link":"symlink",f=n?a.resolve(i.dirname,i.linkpath):i.linkpath;if(n)return e(i,f,o);t.readlink(i._path,function(t,n){if(n&&n===f)return r(i);e(i,f,o)})},i.prototype.end=function(){this._ended=!0,this.ready&&(this._finished=!0,this._finish())};