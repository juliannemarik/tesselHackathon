function e(){c&&(c=!1,p.forEach(function(e){try{process.removeListener(e,o[e])}catch(e){}}),process.emit=u,process.reallyExit=l,n.count-=1)}function t(e,t,i){n.emitted[e]||(n.emitted[e]=!0,n.emit(e,t,i))}function i(){c||(c=!0,n.count+=1,p=p.filter(function(e){try{return process.on(e,o[e]),!0}catch(e){return!1}}),process.emit=s,process.reallyExit=r)}function r(e){process.exitCode=e||0,t("exit",process.exitCode,null),t("afterexit",process.exitCode,null),l.call(process,process.exitCode)}function s(e,i){if("exit"===e){void 0!==i&&(process.exitCode=i);var r=u.apply(this,arguments);return t("exit",process.exitCode,null),t("afterexit",process.exitCode,null),r}return u.apply(this,arguments)}var n,o,c,l,u,a=require("assert"),p=require("./signals.js"),x=require("events");"function"!=typeof x&&(x=x.EventEmitter),process.__signal_exit_emitter__?n=process.__signal_exit_emitter__:((n=process.__signal_exit_emitter__=new x).count=0,n.emitted={}),n.infinite||(n.setMaxListeners(Infinity),n.infinite=!0),module.exports=function(t,r){var s,o;return a.equal(typeof t,"function","a callback must be provided for exit handler"),!1===c&&i(),s="exit",r&&r.alwaysLast&&(s="afterexit"),o=function(){n.removeListener(s,t),0===n.listeners("exit").length&&0===n.listeners("afterexit").length&&e()},n.on(s,t),o},module.exports.unload=e,o={},p.forEach(function(i){o[i]=function(){process.listeners(i).length===n.count&&(e(),t("exit",null,i),t("afterexit",null,i),process.kill(process.pid,i))}}),module.exports.signals=function(){return p},module.exports.load=i,c=!1,l=process.reallyExit,u=process.emit;