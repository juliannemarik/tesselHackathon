function t(t,e){if(this.writable=this.readable=!0,this._opt=e||{},this._chunkSize=t||512,this._offset=0,this._buffer=[],this._bufferLength=0,this._opt.nopad)this._zeroes=!1;else{this._zeroes=new Buffer(this._chunkSize);for(var i=0;i<this._chunkSize;i++)this._zeroes[i]=0}}module.exports=t;var e=require("stream").Stream,i=require("inherits"),s=require("assert").ok;process.env.DEBUG,i(t,e),t.prototype.write=function(t){if(this._ended)throw Error("BlockStream: write after end");if(t&&!Buffer.isBuffer(t)&&(t=new Buffer(t+"")),t.length&&(this._buffer.push(t),this._bufferLength+=t.length),this._bufferLength>=this._chunkSize){if(this._paused)return this._needDrain=!0,!1;this._emitChunk()}return!0},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){return this._paused=!1,this._emitChunk()},t.prototype.end=function(t){"function"==typeof t&&(cb=t,t=null),t&&this.write(t),this._ended=!0,this.flush()},t.prototype.flush=function(){this._emitChunk(!0)},t.prototype._emitChunk=function(t){var e,i,h,f,n,r,_,u,o;if(t&&this._zeroes&&(0!=(e=this._bufferLength%this._chunkSize)&&(e=this._chunkSize-e),e>0&&(this._buffer.push(this._zeroes.slice(0,e)),this._bufferLength+=e)),!this._emitting&&!this._paused){for(this._emitting=!0,i=0;this._bufferLength>=this._chunkSize&&(t||!this._paused);){for(f=0,n=this._chunkSize;n>0&&(t||!this._paused);)_=(r=this._buffer[i]).length-this._offset,h||_<n?(h=h||new Buffer(this._chunkSize),r.copy(h,f,this._offset,this._offset+Math.min(_,n))):h=r.length===n&&0===this._offset?r:r.slice(this._offset,this._offset+n),_>n?(this._offset+=n,n=0):(n-=_,f+=_,i++,this._offset=0);this._bufferLength-=this._chunkSize,s(h.length===this._chunkSize),this.emit("data",h),h=null}if(this._buffer=this._buffer.slice(i),this._paused)return this._needsDrain=!0,void(this._emitting=!1);if(u=this._buffer.length,t&&!this._zeroes&&u){if(1===u)this._offset?this.emit("data",this._buffer[0].slice(this._offset)):this.emit("data",this._buffer[0]);else{for(n=this._bufferLength,h=new Buffer(n),f=0,o=0;o<u;o++)_=(r=this._buffer[o]).length-this._offset,r.copy(h,f,this._offset),this._offset=0,f+=_,this._bufferLength-=_;this.emit("data",h)}this._buffer.length=0,this._bufferLength=0,this._offset=0}this._needDrain&&(this._needDrain=!1,this.emit("drain")),0===this._bufferLength&&this._ended&&!this._endEmitted&&(this._endEmitted=!0,this.emit("end")),this._emitting=!1}};