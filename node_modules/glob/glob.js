function t(t,i,e){if("function"==typeof i&&(e=i,i={}),i||(i={}),i.sync){if(e)throw new TypeError("callback provided to sync glob");return p(t,i)}return new r(t,i,e)}function i(t,i){if(null===i||"object"!=typeof i)return t;for(var r=Object.keys(i),e=r.length;e--;)t[r[e]]=i[r[e]];return t}function r(t,i,e){function s(){--a._processing,a._processing<=0&&(h?process.nextTick(function(){a._finish()}):a._finish())}if("function"==typeof i&&(e=i,i=null),i&&i.sync){if(e)throw new TypeError("callback provided to sync glob");return new g(t,i)}if(!(this instanceof r))return new r(t,i,e);d(this,t,i),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),"function"==typeof e&&(e=b(e),this.on("error",e),this.on("end",function(t){e(null,t)}));var a=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===n)return s();for(var h=!0,o=0;o<n;o++)this._process(this.minimatch.set[o],o,!1,s);h=!1}function e(t,i,r){return function(e,s){e?t._readdirError(i,e,r):t._readdirEntries(i,s,r)}}module.exports=t;var s=require("fs"),n=require("fs.realpath"),a=require("minimatch"),h=(a.Minimatch,require("inherits")),o=require("events").EventEmitter,c=require("path"),u=require("assert"),f=require("path-is-absolute"),p=require("./sync.js"),l=require("./common.js"),d=(l.alphasort,l.alphasorti,l.setopts),_=l.ownProp,m=require("inflight"),v=(require("util"),l.childrenIgnored),y=l.isIgnored,b=require("once");t.sync=p;var g=t.GlobSync=p.GlobSync;t.glob=t,t.hasMagic=function(t,e){var s=i({},e);s.noprocess=!0;var n=new r(t,s).minimatch.set;if(!t)return!1;if(n.length>1)return!0;for(var a=0;a<n[0].length;a++)if("string"!=typeof n[0][a])return!0;return!1},t.Glob=r,h(r,o),r.prototype._finish=function(){if(u(this instanceof r),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();l.finish(this),this.emit("end",this.found)}},r.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var t=this.matches.length;if(0===t)return this._finish();for(var i=this,r=0;r<this.matches.length;r++)this._realpathSet(r,function(){0==--t&&i._finish()})}},r.prototype._realpathSet=function(t,i){var r=this.matches[t];if(!r)return i();var e=Object.keys(r),s=this,a=e.length;if(0===a)return i();var h=this.matches[t]=Object.create(null);e.forEach(function(r){r=s._makeAbs(r),n.realpath(r,s.realpathCache,function(e,n){e?"stat"===e.syscall?h[r]=!0:s.emit("error",e):h[n]=!0,0==--a&&(s.matches[t]=h,i())})})},r.prototype._mark=function(t){return l.mark(this,t)},r.prototype._makeAbs=function(t){return l.makeAbs(this,t)},r.prototype.abort=function(){this.aborted=!0,this.emit("abort")},r.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},r.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);for(this._emitQueue.length=0,e=0;e<t.length;e++){var i=t[e];this._emitMatch(i[0],i[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<r.length;e++){var s=r[e];this._processing--,this._process(s[0],s[1],s[2],s[3])}}}},r.prototype._process=function(t,i,e,s){if(u(this instanceof r),u("function"==typeof s),!this.aborted)if(this._processing++,this.paused)this._processQueue.push([t,i,e,s]);else{for(var n=0;"string"==typeof t[n];)n++;var h;switch(n){case t.length:return void this._processSimple(t.join("/"),i,s);case 0:h=null;break;default:h=t.slice(0,n).join("/")}var o,c=t.slice(n);null===h?o=".":f(h)||f(t.join("/"))?(h&&f(h)||(h="/"+h),o=h):o=h;var p=this._makeAbs(o);if(v(this,o))return s();c[0]===a.GLOBSTAR?this._processGlobStar(h,o,p,c,i,e,s):this._processReaddir(h,o,p,c,i,e,s)}},r.prototype._processReaddir=function(t,i,r,e,s,n,a){var h=this;this._readdir(r,n,function(o,c){return h._processReaddir2(t,i,r,e,s,n,c,a)})},r.prototype._processReaddir2=function(t,i,r,e,s,n,a,h){if(!a)return h();for(var o=e[0],u=!!this.minimatch.negate,f=o._glob,p=this.dot||"."===f.charAt(0),l=[],d=0;d<a.length;d++)("."!==(m=a[d]).charAt(0)||p)&&(u&&!t?!m.match(o):m.match(o))&&l.push(m);var _=l.length;if(0===_)return h();if(1===e.length&&!this.mark&&!this.stat){for(this.matches[s]||(this.matches[s]=Object.create(null)),d=0;d<_;d++)m=l[d],t&&(m="/"!==t?t+"/"+m:t+m),"/"!==m.charAt(0)||this.nomount||(m=c.join(this.root,m)),this._emitMatch(s,m);return h()}for(e.shift(),d=0;d<_;d++){var m=l[d];t&&(m="/"!==t?t+"/"+m:t+m),this._process([m].concat(e),s,n,h)}h()},r.prototype._emitMatch=function(t,i){if(!this.aborted&&!y(this,i))if(this.paused)this._emitQueue.push([t,i]);else{var r=f(i)?i:this._makeAbs(i);if(this.mark&&(i=this._mark(i)),this.absolute&&(i=r),!this.matches[t][i]){if(this.nodir){var e=this.cache[r];if("DIR"===e||Array.isArray(e))return}this.matches[t][i]=!0;var s=this.statCache[r];s&&this.emit("stat",i,s),this.emit("match",i)}}},r.prototype._readdirInGlobStar=function(t,i){if(!this.aborted){if(this.follow)return this._readdir(t,!1,i);var r=this,e=m("lstat\0"+t,function(e,s){if(e&&"ENOENT"===e.code)return i();var n=s&&s.isSymbolicLink();r.symlinks[t]=n,n||!s||s.isDirectory()?r._readdir(t,!1,i):(r.cache[t]="FILE",i())});e&&s.lstat(t,e)}},r.prototype._readdir=function(t,i,r){if(!this.aborted&&(r=m("readdir\0"+t+"\0"+i,r))){if(i&&!_(this.symlinks,t))return this._readdirInGlobStar(t,r);if(_(this.cache,t)){var n=this.cache[t];if(!n||"FILE"===n)return r();if(Array.isArray(n))return r(null,n)}s.readdir(t,e(this,t,r))}},r.prototype._readdirEntries=function(t,i,r){if(!this.aborted){if(!this.mark&&!this.stat)for(var e=0;e<i.length;e++){var s=i[e];s="/"===t?t+s:t+"/"+s,this.cache[s]=!0}return this.cache[t]=i,r(null,i)}},r.prototype._readdirError=function(t,i,r){if(!this.aborted){switch(i.code){case"ENOTSUP":case"ENOTDIR":var e=this._makeAbs(t);if(this.cache[e]="FILE",e===this.cwdAbs){var s=new Error(i.code+" invalid cwd "+this.cwd);s.path=this.cwd,s.code=i.code,this.emit("error",s),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",i),this.abort()),this.silent||console.error("glob error",i)}return r()}},r.prototype._processGlobStar=function(t,i,r,e,s,n,a){var h=this;this._readdir(r,n,function(o,c){h._processGlobStar2(t,i,r,e,s,n,c,a)})},r.prototype._processGlobStar2=function(t,i,r,e,s,n,a,h){if(!a)return h();var o=e.slice(1),c=t?[t]:[],u=c.concat(o);this._process(u,s,!1,h);var f=this.symlinks[r],p=a.length;if(f&&n)return h();for(var l=0;l<p;l++)if("."!==a[l].charAt(0)||this.dot){var d=c.concat(a[l],o);this._process(d,s,!0,h);var _=c.concat(a[l],e);this._process(_,s,!0,h)}h()},r.prototype._processSimple=function(t,i,r){var e=this;this._stat(t,function(s,n){e._processSimple2(t,i,s,n,r)})},r.prototype._processSimple2=function(t,i,r,e,s){if(this.matches[i]||(this.matches[i]=Object.create(null)),!e)return s();if(t&&f(t)&&!this.nomount){var n=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=c.join(this.root,t):(t=c.resolve(this.root,t),n&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(i,t),s()},r.prototype._stat=function(t,i){var r=this._makeAbs(t),e="/"===t.slice(-1);if(t.length>this.maxLength)return i();if(!this.stat&&_(this.cache,r)){var n=this.cache[r];if(Array.isArray(n)&&(n="DIR"),!e||"DIR"===n)return i(null,n);if(e&&"FILE"===n)return i()}var a=this.statCache[r];if(void 0!==a){if(!1===a)return i(null,a);var h=a.isDirectory()?"DIR":"FILE";return e&&"FILE"===h?i():i(null,h,a)}var o=this,c=m("stat\0"+r,function(e,n){if(n&&n.isSymbolicLink())return s.stat(r,function(e,s){e?o._stat2(t,r,null,n,i):o._stat2(t,r,e,s,i)});o._stat2(t,r,e,n,i)});c&&s.lstat(r,c)},r.prototype._stat2=function(t,i,r,e,s){if(r&&("ENOENT"===r.code||"ENOTDIR"===r.code))return this.statCache[i]=!1,s();var n="/"===t.slice(-1);if(this.statCache[i]=e,"/"===i.slice(-1)&&e&&!e.isDirectory())return s(null,!1,e);var a=!0;return e&&(a=e.isDirectory()?"DIR":"FILE"),this.cache[i]=this.cache[i]||a,n&&"FILE"===a?s():s(null,a,e)};