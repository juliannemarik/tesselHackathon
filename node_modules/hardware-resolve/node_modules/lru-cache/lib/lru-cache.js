!function(){function t(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function e(){return 1}function i(t){l||"string"==typeof t||"number"==typeof t||(l=!0,console.error(new TypeError("LRU: key must be a string or number. Almost certainly a bug! "+typeof t).stack))}function h(t){if(!(this instanceof h))return new h(t);"number"==typeof t&&(t={max:t}),t||(t={}),this._max=t.max,(!this._max||"number"!=typeof this._max||this._max<=0)&&(this._max=Infinity),this._lengthCalculator=t.length||e,"function"!=typeof this._lengthCalculator&&(this._lengthCalculator=e),this._allowStale=t.stale||!1,this._maxAge=t.maxAge||null,this._dispose=t.dispose,this.reset()}function s(t,e,h){i(e);var s=t._cache[e];return s&&(n(t,s)?(u(t,s),t._allowStale||(s=void 0)):h&&function(t,e){o(t,e),e.lu=t._mru++,t._lruList[e.lu]=e}(t,s),s&&(s=s.value)),s}function n(t,e){var i;return!(!e||!e.maxAge&&!t._maxAge)&&(i=Date.now()-e.now,e.maxAge?i>e.maxAge:t._maxAge&&i>t._maxAge)}function r(t){for(;t._lru<t._mru&&t._length>t._max;)u(t,t._lruList[t._lru])}function o(t,e){for(delete t._lruList[e.lu];t._lru<t._mru&&!t._lruList[t._lru];)t._lru++}function u(t,e){e&&(t._dispose&&t._dispose(e.key,e.value),t._length-=e.length,t._itemCount--,delete t._cache[e.key],o(t,e))}"object"==typeof module&&module.exports?module.exports=h:this.LRUCache=h;var l=!1;Object.defineProperty(h.prototype,"max",{set:function(t){(!t||"number"!=typeof t||t<=0)&&(t=Infinity),this._max=t,this._length>this._max&&r(this)},get:function(){return this._max},enumerable:!0}),Object.defineProperty(h.prototype,"lengthCalculator",{set:function(t){var i;if("function"!=typeof t){this._lengthCalculator=e,this._length=this._itemCount;for(i in this._cache)this._cache[i].length=1}else{this._lengthCalculator=t,this._length=0;for(i in this._cache)this._cache[i].length=this._lengthCalculator(this._cache[i].value),this._length+=this._cache[i].length}this._length>this._max&&r(this)},get:function(){return this._lengthCalculator},enumerable:!0}),Object.defineProperty(h.prototype,"length",{get:function(){return this._length},enumerable:!0}),Object.defineProperty(h.prototype,"itemCount",{get:function(){return this._itemCount},enumerable:!0}),h.prototype.forEach=function(t,e){var i,h,s,r;for(e=e||this,i=0,h=this._itemCount,s=this._mru-1;s>=0&&i<h;s--)this._lruList[s]&&(i++,n(this,r=this._lruList[s])&&(u(this,r),this._allowStale||(r=void 0)),r&&t.call(e,r.value,r.key,this))},h.prototype.keys=function(){var t,e,i=Array(this._itemCount),h=0;for(t=this._mru-1;t>=0&&h<this._itemCount;t--)this._lruList[t]&&(e=this._lruList[t],i[h++]=e.key);return i},h.prototype.values=function(){var t,e,i=Array(this._itemCount),h=0;for(t=this._mru-1;t>=0&&h<this._itemCount;t--)this._lruList[t]&&(e=this._lruList[t],i[h++]=e.value);return i},h.prototype.reset=function(){if(this._dispose&&this._cache)for(var t in this._cache)this._dispose(t,this._cache[t].value);this._cache=Object.create(null),this._lruList=Object.create(null),this._mru=0,this._lru=0,this._length=0,this._itemCount=0},h.prototype.dump=function(){var t,e,i=[],h=0;for(t=this._mru-1;t>=0&&h<this._itemCount;t--)this._lruList[t]&&(n(this,e=this._lruList[t])||(++h,i.push({k:e.key,v:e.value,e:e.now+(e.maxAge||0)})));return i},h.prototype.dumpLru=function(){return this._lruList},h.prototype.set=function(e,h,s){var n,o,l;return s=s||this._maxAge,i(e),n=s?Date.now():0,o=this._lengthCalculator(h),t(this._cache,e)?o>this._max?(u(this,this._cache[e]),!1):(this._dispose&&this._dispose(e,this._cache[e].value),this._cache[e].now=n,this._cache[e].maxAge=s,this._cache[e].value=h,this._length+=o-this._cache[e].length,this._cache[e].length=o,this.get(e),this._length>this._max&&r(this),!0):(l=new function(t,e,i,h,s,n){this.key=t,this.value=e,this.lu=i,this.length=h,this.now=s,n&&(this.maxAge=n)}(e,h,this._mru++,o,n,s)).length>this._max?(this._dispose&&this._dispose(e,h),!1):(this._length+=l.length,this._lruList[l.lu]=this._cache[e]=l,this._itemCount++,this._length>this._max&&r(this),!0)},h.prototype.has=function(e){return i(e),!!t(this._cache,e)&&!n(this,this._cache[e])},h.prototype.get=function(t){return i(t),s(this,t,!0)},h.prototype.peek=function(t){return i(t),s(this,t,!1)},h.prototype.pop=function(){var t=this._lruList[this._lru];return u(this,t),t||null},h.prototype.del=function(t){i(t),u(this,this._cache[t])},h.prototype.load=function(t){var e,h,s,n,r;for(this.reset(),e=Date.now(),h=t.length-1;h>=0;h--)i((s=t[h]).k),0===(n=s.e||0)?this.set(s.k,s.v):(r=n-e)>0&&this.set(s.k,s.v,r)}}();