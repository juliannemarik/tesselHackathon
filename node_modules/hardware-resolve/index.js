function e(e){return"object"==typeof e}function n(n){return new s.Minimatch(n).set.some(function(n){return n.some(e)})}function o(){}function r(e,c,u,f){function d(o){Object.keys(o).forEach(function(r){if(r.match(/:/))return S[r.replace(/:.*$/,"")]||(S[r.replace(/:.*$/,"")]={}),void(S[r.replace(/:.*$/,"")][r.replace(/^.*?:/,"")]=o[r]);if("/"!=r[0]&&"."!=r[0])n(r)?h.push([new s.Minimatch(r),o[r]]):y[r]=o[r];else if(n(r))j.push([new s.Minimatch(r.substr(2)),o[r]]);else try{"string"!=typeof o[r]&&t.lstatSync(i.join(e,r)).isDirectory()?j.push([new s.Minimatch(i.join(r,"**")),o[r]]):p[r.substr(2)]="string"==typeof o[r]?i.join("/",o[r]).substr(1):o[r]}catch(e){p[r.substr(2)]="string"==typeof o[r]?i.join("/",o[r]).substr(1):o[r]}})}var l,m,h,y,j,p,S,b;c=c||{},u=u||{},l=("/"==e[0]||"."==e[0]?"":"./")+i.join(e,"package.json");try{m=require(l,"utf-8")}catch(e){m={},t.existsSync(l)&&o()}h=[],y={},j=[],p={},S={},d(m.hardware||{}),f&&d(f),d({"./package.json":!0}),a.readdirRecursiveSync(e,{inflateSymlinks:!0,excludeHiddenUnix:!0,filter:function(n,o){return!(i.normalize(o)==i.normalize(e)&&"node_modules"==n)}}).filter(function(e){var n=!0;j.forEach(function(o){o[0].match(e)&&(n=o[1])}),Object.keys(p).forEach(function(o){e==o&&(n=p[o])}),n&&(c[e]=!0===n?e:n)}),b=[];try{b=t.readdirSync(i.join(e,"node_modules")).filter(function(n){return t.statSync(i.join(e,"node_modules",n)).isDirectory()})}catch(e){}return b.filter(function(e){var n=!0;h.forEach(function(o){o[0].match(e)&&(n=o[1])}),Object.keys(y).forEach(function(o){e==o&&(n=y[o])}),n&&(u[e]=!0===n?e:n)}),Object.keys(u).forEach(function(n){if(t.existsSync(i.join(e,"node_modules",u[n]))){var s=r(i.join(e,"node_modules",u[n]),null,null,S[n]||{});Object.keys(s).forEach(function(e){c[i.join("node_modules",u[n],e)]=i.join("node_modules",u[n],s[e])})}else o(i.join(e,"node_modules",u[n]))}),c}require("assert");var t=require("fs"),i=require("path"),s=require("minimatch"),c=require("osenv"),a=require("effess");exports.list=r,exports.root=function(e,n){var o,r;for(t.lstatSync(e).isDirectory()&&(e=i.join(e,"index.js")),t.lstatSync(e),o=t.realpathSync(i.dirname(e)),r="";i.dirname(o)!=o&&!t.existsSync(i.join(o,"package.json"))&&!t.existsSync(i.join(o,"node_modules"));)r=i.join(i.basename(o),r),o=i.dirname(o);return i.dirname(o)==o?n(Error("No package.json or node_modules found.")):t.realpathSync(c.home())==t.realpathSync(o)?n(Error("No package.json or node_modules found. (Cowardly refusing to use the home directory, even though ~/package.json or ~/node_modules exists.)")):void n(null,o,i.join(r,i.basename(e)))};