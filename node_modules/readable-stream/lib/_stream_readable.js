"use strict";function e(e,t){var n,r,i,a;m=m||require("./_stream_duplex"),e=e||{},n=t instanceof m,this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),r=e.highWaterMark,i=e.readableHighWaterMark,a=this.objectMode?16:16384,this.highWaterMark=r||0===r?r:n&&(i||0===i)?i:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new j,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(E||(E=require("string_decoder/").StringDecoder),this.decoder=new E(e.encoding),this.encoding=e.encoding)}function t(n){if(m=m||require("./_stream_duplex"),!(this instanceof t))return new t(n);this._readableState=new e(n,this),this.readable=!0,n&&("function"==typeof n.read&&(this._read=n.read),"function"==typeof n.destroy&&(this._destroy=n.destroy)),_.call(this)}function n(e,t,n,i,d){var s,l=e._readableState;return null===t?(l.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,a(e)}}(e,l)):(d||(s=function(e,t){var n;return function(e){return v.isBuffer(e)||e instanceof w}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(l,t)),s?e.emit("error",s):l.objectMode||t&&t.length>0?("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===v.prototype||(t=function(e){return v.from(e)}(t)),i?l.endEmitted?e.emit("error",Error("stream.unshift() after end event")):r(e,l,t,!0):l.ended?e.emit("error",Error("stream.push() after EOF")):(l.reading=!1,l.decoder&&!n?(t=l.decoder.write(t),l.objectMode||0!==t.length?r(e,l,t,!1):o(e,l)):r(e,l,t,!1))):i||(l.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(l)}function r(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&a(e)),o(e,t)}function i(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function a(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(k("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?q.nextTick(d,e):d(e))}function d(e){k("emit readable"),e.emit("readable"),h(e)}function o(e,t){t.readingMore||(t.readingMore=!0,q.nextTick(s,e,t))}function s(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(k("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function l(e){k("readable nexttick read 0"),e.read(0)}function u(e,t){t.reading||(k("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),h(e),t.flowing&&!t.reading&&e.read(0)}function h(e){var t=e._readableState;for(k("flow",t.flowing);t.flowing&&null!==e.read(););}function p(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n,r,i=t.head,a=1,d=i.data;for(e-=d.length;i=i.next;){if(n=i.data,(r=e>n.length?n.length:e)===n.length?d+=n:d+=n.slice(0,e),0==(e-=r)){r===n.length?(++a,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=n.slice(r));break}++a}return t.length-=a,d}(e,t):function(e,t){var n,r,i=v.allocUnsafe(e),a=t.head,d=1;for(a.data.copy(i),e-=a.data.length;a=a.next;){if(n=a.data,r=e>n.length?n.length:e,n.copy(i,i.length-e,0,r),0==(e-=r)){r===n.length?(++d,a.next?t.head=a.next:t.head=t.tail=null):(t.head=a,a.data=n.slice(r));break}++d}return t.length-=d,i}(e,t),r}(e,t.buffer,t.decoder),n}function f(e){var t=e._readableState;if(t.length>0)throw Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,q.nextTick(c,t,e))}function c(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function g(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}var b,m,y,_,v,w,M,S,k,j,R,E,L,x,q=require("process-nextick-args");module.exports=t,b=require("isarray"),t.ReadableState=e,require("events").EventEmitter,y=function(e,t){return e.listeners(t).length},_=require("./internal/streams/stream"),v=require("safe-buffer").Buffer,w=global.Uint8Array||function(){},(M=require("core-util-is")).inherits=require("inherits"),S=require("util"),k=void 0,k=S&&S.debuglog?S.debuglog("stream"):function(){},j=require("./internal/streams/BufferList"),R=require("./internal/streams/destroy"),M.inherits(t,_),L=["error","close","destroy","pause","resume"],Object.defineProperty(t.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),t.prototype.destroy=R.destroy,t.prototype._undestroy=R.undestroy,t.prototype._destroy=function(e,t){this.push(null),t(e)},t.prototype.push=function(e,t){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=v.from(e,t),t=""),r=!0),n(this,e,t,!1,r)},t.prototype.unshift=function(e){return n(this,e,null,!0,!1)},t.prototype.isPaused=function(){return!1===this._readableState.flowing},t.prototype.setEncoding=function(e){return E||(E=require("string_decoder/").StringDecoder),this._readableState.decoder=new E(e),this._readableState.encoding=e,this},x=8388608,t.prototype.read=function(e){var t,n,r,d;return k("read",e),e=parseInt(e,10),t=this._readableState,n=e,0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended)?(k("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?f(this):a(this),null):0===(e=i(e,t))&&t.ended?(0===t.length&&f(this),null):(r=t.needReadable,k("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&k("length less than watermark",r=!0),t.ended||t.reading?k("reading or ended",r=!1):r&&(k("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=i(n,t))),null===(d=e>0?p(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&f(this)),null!==d&&this.emit("data",d),d)},t.prototype._read=function(){this.emit("error",Error("_read() is not implemented"))},t.prototype.pipe=function(e,t){function n(t,l){k("onunpipe"),t===m&&l&&!1===l.hasUnpiped&&(l.hasUnpiped=!0,k("cleanup"),e.removeListener("close",d),e.removeListener("finish",o),e.removeListener("drain",p),e.removeListener("error",a),e.removeListener("unpipe",n),m.removeListener("end",r),m.removeListener("end",s),m.removeListener("data",i),f=!0,!_.awaitDrain||e._writableState&&!e._writableState.needDrain||p())}function r(){k("onend"),e.end()}function i(t){k("ondata"),c=!1,!1!==e.write(t)||c||((1===_.pipesCount&&_.pipes===e||_.pipesCount>1&&-1!==g(_.pipes,e))&&!f&&(k("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,c=!0),m.pause())}function a(t){k("onerror",t),s(),e.removeListener("error",a),0===y(e,"error")&&e.emit("error",t)}function d(){e.removeListener("finish",o),s()}function o(){k("onfinish"),e.removeListener("close",d),s()}function s(){k("unpipe"),m.unpipe(e)}var l,u,p,f,c,m=this,_=this._readableState;switch(_.pipesCount){case 0:_.pipes=e;break;case 1:_.pipes=[_.pipes,e];break;default:_.pipes.push(e)}return _.pipesCount+=1,k("pipe count=%d opts=%j",_.pipesCount,t),l=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr,u=l?r:s,_.endEmitted?q.nextTick(u):m.once("end",u),e.on("unpipe",n),p=function(e){return function(){var t=e._readableState;k("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&y(e,"data")&&(t.flowing=!0,h(e))}}(m),e.on("drain",p),f=!1,c=!1,m.on("data",i),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener("error",n);e._events&&e._events.error?b(e._events.error)?e._events.error.unshift(n):e._events.error=[n,e._events.error]:e.on("error",n)}(e,0,a),e.once("close",d),e.once("finish",o),e.emit("pipe",m),_.flowing||(k("pipe resume"),m.resume()),e},t.prototype.unpipe=function(e){var t,n,r,i,a=this._readableState,d={hasUnpiped:!1};if(0===a.pipesCount)return this;if(1===a.pipesCount)return e&&e!==a.pipes?this:(e||(e=a.pipes),a.pipes=null,a.pipesCount=0,a.flowing=!1,e&&e.emit("unpipe",this,d),this);if(!e){for(t=a.pipes,n=a.pipesCount,a.pipes=null,a.pipesCount=0,a.flowing=!1,r=0;r<n;r++)t[r].emit("unpipe",this,d);return this}return-1===(i=g(a.pipes,e))?this:(a.pipes.splice(i,1),a.pipesCount-=1,1===a.pipesCount&&(a.pipes=a.pipes[0]),e.emit("unpipe",this,d),this)},t.prototype.on=function(e,t){var n,r=_.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"===e&&((n=this._readableState).endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&a(this):q.nextTick(l,this))),r},t.prototype.addListener=t.prototype.on,t.prototype.resume=function(){var e=this._readableState;return e.flowing||(k("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,q.nextTick(u,e,t))}(this,e)),this},t.prototype.pause=function(){return k("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(k("pause"),this._readableState.flowing=!1,this.emit("pause")),this},t.prototype.wrap=function(e){var t,n,r=this,i=this._readableState,a=!1;e.on("end",function(){if(k("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(t){k("wrapped data"),i.decoder&&(t=i.decoder.write(t)),(!i.objectMode||null!==t&&void 0!==t)&&(i.objectMode||t&&t.length)&&(r.push(t)||(a=!0,e.pause()))});for(t in e)void 0===this[t]&&"function"==typeof e[t]&&(this[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t));for(n=0;n<L.length;n++)e.on(L[n],this.emit.bind(this,L[n]));return this._read=function(t){k("wrapped _read",t),a&&(a=!1,e.resume())},this},Object.defineProperty(t.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),t._fromList=p;