function encodeRegExp(e){var r="";return e.global&&(r+="g"),e.multiline&&(r+="m"),e.ignoreCase&&(r+="i"),[r,e.source].join(",")}function decodeRegExp(e){var r=e.match(/^[^,]*/)[0],t=e.substr(r.length+1);return RegExp(t,r)}function derez(e,r,t,n,i){var u,f,o,s;if(Buffer.isBuffer(e))return u=Buffer.concat(i).length,i.push(e),"b"+[u,e.length].join(",");if(e instanceof Date)return"d"+e.toJSON();if(e instanceof RegExp)return"r"+encodeRegExp(e);if(e instanceof Error)return"e"+e.message;if("string"==typeof e)return""==e.charAt(0)?"s"+e:e;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Number||e instanceof String)){if(-1!==(f=t.indexOf(e)))return"j"+n[f];if(t.push(e),n.push(r),Array.isArray(e))for(s=[],f=0;f<e.length;f+=1)s[f]=derez(e[f],r+"["+f+"]",t,n,i);else{s={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&"__proto__"!=e&&(s[o]=derez(e[o],r+"["+JSON.stringify(o)+"]",t,n,i))}return s}return e}function rerez($,$$){function redo(item){var bounds,path;if("string"==typeof item&&""==item.charAt(0))switch(item.charAt(1)){case"s":return item.substr(2);case"b":return bounds=item.substr(2).split(",",2),$$.slice(bounds[0]||0,(bounds[0]||0)+(bounds[1]||[0]));case"d":return new Date(item.substr(2));case"r":return decodeRegExp(item.substr(2));case"e":return Error(item.substr(2));case"j":if(path=item.substr(2),px.test(path))return eval(path);default:return null}return item&&"object"==typeof item&&rez(item),item}function rez(e){var r,t;if(e&&"object"==typeof e)if(Array.isArray(e))for(r=0;r<e.length;r+=1)e[r]=redo(e[r]);else for(t in e)e[t]=redo(e[t])}var px=/^\${1,4}(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return $=redo($)}exports.serialize=function(e){var r,t=[],n=new Buffer([0]);return Buffer.isBuffer(e)?Buffer.concat([n,e]):(r=new Buffer(JSON.stringify(derez(e,"$",[],[],t))),0==t.length?r:Buffer.concat([r,n,Buffer.concat(t)]))},exports.deserialize=function(e){var r,t,n;for(r=0;r<=e.length&&0!=e[r]&&null!=e[r];r++);return t=e.slice(0,r),n=e.slice(r+1),0==t.length?n:rerez(JSON.parse(t.toString("utf-8")),n)};