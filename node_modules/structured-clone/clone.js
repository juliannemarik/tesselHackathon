function e(r,n,s){var t,f,i;if(n=n||[],s=s||[],n.indexOf(r)>-1)return s[n.indexOf(r)];if(null===r||!(r instanceof Object))return r;switch(f=r.constructor){case RegExp:t=new f(r.source,"g".substr(0,+r.global)+"i".substr(0,+r.ignoreCase)+"m".substr(0,+r.multiline));break;case Date:t=new f(r.getTime());break;default:if(Buffer.isBuffer(r))t=new Buffer(r.length),r.copy(t);else if(r instanceof Error)t=Error(r.message);else{t=new f,n.push(r),s.push(t);for(i in r)t[i]=e(r[i],n,s)}}return t}exports.clone=e;