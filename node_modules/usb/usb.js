function t(t,e){this.device=t,this.id=e,this.altSetting=0,this.__refresh()}function e(t,e){this.device=t,this.descriptor=e,this.address=e.bEndpointAddress,this.transferType=3&e.bmAttributes}function i(t,i){e.call(this,t,i)}function r(t,i){e.call(this,t,i)}var n,o,s=require("node-pre-gyp"),c=require("path"),f=s.find(c.resolve(c.join(__dirname,"./package.json"))),p=exports=module.exports=require(f),a=require("events"),h=require("util");p.INIT_ERROR&&(console.warn("Failed to initialize libusb."),p.Device=function(){throw Error("Device cannot be instantiated directly.")},p.Transfer=function(){throw Error("Transfer cannot be instantiated directly.")},p.setDebugLevel=function(){},p.getDeviceList=function(){return[]},p._enableHotplugEvents=function(){},p._disableHotplugEvents=function(){}),Object.keys(a.EventEmitter.prototype).forEach(function(t){exports[t]=a.EventEmitter.prototype[t]}),exports.findByIds=function(t,e){var i,r,n=p.getDeviceList();for(i=0;i<n.length;i++)if((r=n[i].deviceDescriptor).idVendor==t&&r.idProduct==e)return n[i]},p.Device.prototype.timeout=1e3,p.Device.prototype.open=function(e){var i,r;if(this.__open(),!1!==e)for(this.interfaces=[],i=this.configDescriptor.interfaces.length,r=0;r<i;r++)this.interfaces[r]=new t(this,r)},p.Device.prototype.close=function(){this.__close(),this.interfaces=null},Object.defineProperty(p.Device.prototype,"configDescriptor",{get:function(){return this._configDescriptor||(this._configDescriptor=this.__getConfigDescriptor())}}),Object.defineProperty(p.Device.prototype,"allConfigDescriptors",{get:function(){return this._allConfigDescriptors||(this._allConfigDescriptors=this.__getAllConfigDescriptors())}}),Object.defineProperty(p.Device.prototype,"parent",{get:function(){return this._parent||(this._parent=this.__getParent())}}),p.Device.prototype.interface=function(t){if(!this.interfaces)throw Error("Device must be open before searching for interfaces");t=t||0;for(var e=0;e<this.interfaces.length;e++)if(this.interfaces[e].interfaceNumber==t)return this.interfaces[e]},n=p.LIBUSB_CONTROL_SETUP_SIZE,p.Device.prototype.controlTransfer=function(t,e,i,r,o,s){var c,f,a,h=this,l=!!(t&p.LIBUSB_ENDPOINT_IN);if(l){if(!(o>=0))throw new TypeError("Expected size number for IN transfer (based on bmRequestType)");c=o}else{if(!Buffer.isBuffer(o))throw new TypeError("Expected buffer for OUT transfer (based on bmRequestType)");c=o.length}(f=new Buffer(c+n)).writeUInt8(t,0),f.writeUInt8(e,1),f.writeUInt16LE(i,2),f.writeUInt16LE(r,4),f.writeUInt16LE(c,6),l||o.copy(f,n),a=new p.Transfer(this,0,p.LIBUSB_TRANSFER_TYPE_CONTROL,this.timeout,function(t,e,i){s&&(l?s.call(h,t,e.slice(n,n+i)):s.call(h,t))});try{a.submit(f)}catch(t){s&&process.nextTick(function(){s.call(h,t)})}return this},p.Device.prototype.getStringDescriptor=function(t,e){this.controlTransfer(p.LIBUSB_ENDPOINT_IN,p.LIBUSB_REQUEST_GET_DESCRIPTOR,p.LIBUSB_DT_STRING<<8|t,1033,255,function(t,i){if(t)return e(t);e(void 0,i.toString("utf16le",2))})},p.Device.prototype.setConfiguration=function(e,i){var r=this;this.__setConfiguration(e,function(e){var n,o;if(!e)for(this.interfaces=[],n=this.configDescriptor.interfaces.length,o=0;o<n;o++)this.interfaces[o]=new t(this,o);i.call(r,e)})},t.prototype.__refresh=function(){var t,e,n,o;for(this.descriptor=this.device.configDescriptor.interfaces[this.id][this.altSetting],this.interfaceNumber=this.descriptor.bInterfaceNumber,this.endpoints=[],t=this.descriptor.endpoints.length,e=0;e<t;e++)o=(n=this.descriptor.endpoints[e]).bEndpointAddress&p.LIBUSB_ENDPOINT_IN?i:r,this.endpoints[e]=new o(this.device,n)},t.prototype.claim=function(){this.device.__claimInterface(this.id)},t.prototype.release=function(t,e){function i(){n.device.__releaseInterface(n.id,function(t){t||(n.altSetting=0,n.__refresh()),e.call(n,t)})}var r,n=this;"function"==typeof t&&(e=t,t=null),t&&0!=this.endpoints.length?(r=n.endpoints.length,n.endpoints.forEach(function(t){t.pollActive?(t.once("end",function(){0==--r&&i()}),t.stopPoll()):0==--r&&i()})):i()},t.prototype.isKernelDriverActive=function(){return this.device.__isKernelDriverActive(this.id)},t.prototype.detachKernelDriver=function(){return this.device.__detachKernelDriver(this.id)},t.prototype.attachKernelDriver=function(){return this.device.__attachKernelDriver(this.id)},t.prototype.setAltSetting=function(t,e){var i=this;this.device.__setInterface(this.id,t,function(r){r||(i.altSetting=t,i.__refresh()),e.call(i,r)})},t.prototype.endpoint=function(t){for(var e=0;e<this.endpoints.length;e++)if(this.endpoints[e].address==t)return this.endpoints[e]},h.inherits(e,a.EventEmitter),e.prototype.timeout=0,e.prototype.makeTransfer=function(t,e){return new p.Transfer(this.device,this.address,this.transferType,t,e)},e.prototype.startPoll=function(t,e,i){var r,n;if(this.pollTransfers)throw Error("Polling already active");for(t=t||3,this.pollTransferSize=e||this.descriptor.wMaxPacketSize,this.pollActive=!0,this.pollPending=0,r=[],n=0;n<t;n++)r[n]=this.makeTransfer(0,i);return r},e.prototype.stopPoll=function(t){if(!this.pollTransfers)throw Error("Polling is not active.");for(var e=0;e<this.pollTransfers.length;e++)try{this.pollTransfers[e].cancel()}catch(t){this.emit("error",t)}this.pollActive=!1,t&&this.once("end",t)},exports.InEndpoint=i,h.inherits(i,e),i.prototype.direction="in",i.prototype.transfer=function(t,e){function i(t,i,o){e.call(r,t,n.slice(0,o))}var r=this,n=new Buffer(t);try{this.makeTransfer(this.timeout,i).submit(n)}catch(t){process.nextTick(function(){e.call(r,t)})}return this},i.prototype.startPoll=function(t,e){function r(t,e,i){t?t.errno!=p.LIBUSB_TRANSFER_CANCELLED&&(o.emit("error",t),o.stopPoll()):o.emit("data",e.slice(0,i)),o.pollActive?n(this):(o.pollPending--,0==o.pollPending&&o.emit("end"))}function n(t){try{t.submit(new Buffer(o.pollTransferSize),r)}catch(t){o.emit("error",t),o.stopPoll()}}var o=this;this.pollTransfers=i.super_.prototype.startPoll.call(this,t,e,r),this.pollTransfers.forEach(n),o.pollPending=this.pollTransfers.length},exports.OutEndpoint=r,h.inherits(r,e),r.prototype.direction="out",r.prototype.transfer=function(t,e){function i(t){e&&e.call(r,t)}var r=this;t?Buffer.isBuffer(t)||(t=new Buffer(t)):t=new Buffer(0);try{this.makeTransfer(this.timeout,i).submit(t)}catch(t){process.nextTick(function(){i(t)})}return this},r.prototype.transferWithZLP=function(t,e){t.length%this.descriptor.wMaxPacketSize==0?(this.transfer(t),this.transfer(new Buffer(0),e)):this.transfer(t,e)},o=0,exports.on("newListener",function(t){"attach"!==t&&"detach"!==t||1==++o&&p._enableHotplugEvents()}),exports.on("removeListener",function(t){"attach"!==t&&"detach"!==t||0==--o&&p._disableHotplugEvents()});