function n(){}function c(c,e,o,i){i=i||n,O._curOpen++,O._originalFs.open.call(O,c,e,o,function(n,c){n&&t(),i(n,c)})}function t(){O._curOpen--,e()}function e(){for(;O._curOpen<O.MAX_OPEN;){var n=a.shift();if(!n)return;switch(n.constructor.name){case"OpenReq":c(n.path,n.flags||"r",n.mode||511,n.cb);break;case"ReaddirReq":o(n.path,n.cb);break;case"ReadFileReq":i(n.path,n.options,n.cb);break;case"WriteFileReq":r(n.path,n.data,n.options,n.cb);break;default:throw Error("Unknown req type: "+n.constructor.name)}}}function o(c,e){e=e||n,O._curOpen++,O._originalFs.readdir.call(O,c,function(n,c){t(),e(n,c)})}function i(c,e,o){o=o||n,O._curOpen++,O._originalFs.readFile.call(O,c,e,function(n,c){t(),o(n,c)})}function r(c,e,o,i){i=i||n,O._curOpen++,O._originalFs.writeFile.call(O,c,e,o,function(n){t(),i(n)})}function u(n){return n?function(c,t,e,o){return n.call(O,c,t,e,function(n,c){s(n)&&(n=null),o(n,c)})}:n}function f(n){return n?function(c,t,e){try{return n.call(O,c,t,e)}catch(n){if(!s(n))throw n}}:n}function s(n){if(!n||!(process.getuid&&0===process.getuid()||"EINVAL"!==n.code&&"EPERM"!==n.code))return!0}var a,l,p,h,_,O=exports=module.exports={};O._originalFs=require("fs"),Object.getOwnPropertyNames(O._originalFs).forEach(function(n){var c=Object.getOwnPropertyDescriptor(O._originalFs,n);Object.defineProperty(O,n,c)}),a=[],l=require("constants"),O._curOpen=0,O.MIN_MAX_OPEN=64,O.MAX_OPEN=1024,O.open=function(t,o,i,r){if("function"==typeof i&&(r=i,i=null),"function"!=typeof r&&(r=n),O._curOpen>=O.MAX_OPEN)return a.push(new function(n,c,t,e){this.path=n,this.flags=c,this.mode=t,this.cb=e}(t,o,i,r)),void setTimeout(e);c(t,o,i,function(n,c){if(n&&"EMFILE"===n.code&&O._curOpen>O.MIN_MAX_OPEN)return O.MAX_OPEN=O._curOpen-1,O.open(t,o,i,r);r(n,c)})},O.openSync=function(n,c,t){var e;return e=O._originalFs.openSync.call(O,n,c,t),O._curOpen++,e},O.close=function(c,e){e=e||n,O._originalFs.close.call(O,c,function(n){t(),e(n)})},O.closeSync=function(n){try{return O._originalFs.closeSync.call(O,n)}finally{t()}},O.readdir=function(n,c){if(O._curOpen>=O.MAX_OPEN)return a.push(new function(n,c){this.path=n,this.cb=c}(n,c)),void setTimeout(e);o(n,function(t,e){if(t&&"EMFILE"===t.code&&O._curOpen>O.MIN_MAX_OPEN)return O.MAX_OPEN=O._curOpen-1,O.readdir(n,c);c(t,e)})},O.readFile=function(c,t,o){if("function"==typeof t&&(o=t,t=null),"function"!=typeof o&&(o=n),O._curOpen>=O.MAX_OPEN)return a.push(new function(n,c,t){this.path=n,this.options=c,this.cb=t}(c,t,o)),void setTimeout(e);i(c,t,function(n,e){if(n&&"EMFILE"===n.code&&O._curOpen>O.MIN_MAX_OPEN)return O.MAX_OPEN=O._curOpen-1,O.readFile(c,t,o);o(n,e)})},O.writeFile=function(c,t,o,i){if("function"==typeof o&&(i=o,o=null),"function"!=typeof i&&(i=n),O._curOpen>=O.MAX_OPEN)return a.push(new function(n,c,t,e){this.path=n,this.data=c,this.options=t,this.cb=e}(c,t,o,i)),void setTimeout(e);r(c,t,o,function(n){if(n&&"EMFILE"===n.code&&O._curOpen>O.MIN_MAX_OPEN)return O.MAX_OPEN=O._curOpen-1,O.writeFile(c,t,o,i);i(n)})},(l=require("constants")).hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&(O.lchmod=function(c,t,e){e=e||n,O.open(c,l.O_WRONLY|l.O_SYMLINK,t,function(n,c){n?e(n):O.fchmod(c,t,function(n){O.close(c,function(c){e(n||c)})})})},O.lchmodSync=function(n,c){var t,e,o,i=O.openSync(n,l.O_WRONLY|l.O_SYMLINK,c);try{o=O.fchmodSync(i,c)}catch(n){t=n}try{O.closeSync(i)}catch(n){e=n}if(t||e)throw t||e;return o}),O.lutimes||(l.hasOwnProperty("O_SYMLINK")?(O.lutimes=function(c,t,e,o){O.open(c,l.O_SYMLINK,function(c,i){if(o=o||n,c)return o(c);O.futimes(i,t,e,function(n){O.close(i,function(c){return o(n||c)})})})},O.lutimesSync=function(n,c,t){var e,o,i,r=O.openSync(n,l.O_SYMLINK);try{i=O.futimesSync(r,c,t)}catch(n){e=n}try{O.closeSync(r)}catch(n){o=n}if(e||o)throw e||o;return i}):O.utimensat&&l.hasOwnProperty("AT_SYMLINK_NOFOLLOW")?(O.lutimes=function(n,c,t,e){O.utimensat(n,c,t,l.AT_SYMLINK_NOFOLLOW,e)},O.lutimesSync=function(n,c,t){return O.utimensatSync(n,c,t,l.AT_SYMLINK_NOFOLLOW)}):(O.lutimes=function(n,c,t,e){process.nextTick(e)},O.lutimesSync=function(){})),O.chown=u(O.chown),O.fchown=u(O.fchown),O.lchown=u(O.lchown),O.chownSync=f(O.chownSync),O.fchownSync=f(O.fchownSync),O.lchownSync=f(O.lchownSync),O.lchmod||(O.lchmod=function(n,c,t){process.nextTick(t)},O.lchmodSync=function(){}),O.lchown||(O.lchown=function(n,c,t,e){process.nextTick(e)},O.lchownSync=function(){}),"win32"===process.platform&&(p=O.rename,O.rename=function(n,c,t){var e=Date.now();p(n,c,function o(i){if(i&&("EACCES"===i.code||"EPERM"===i.code)&&Date.now()-e<1e3)return p(n,c,o);t(i)})}),h=O.read,O.read=function(n,c,t,e,o,i){var r,u;return i&&"function"==typeof i&&(u=0,r=function(f){if(f&&"EAGAIN"===f.code&&u<10)return u++,h.call(O,n,c,t,e,o,r);i.apply(this,arguments)}),h.call(O,n,c,t,e,o,r)},_=O.readSync,O.readSync=function(n,c,t,e,o){for(var i=0;;)try{return _.call(O,n,c,t,e,o)}catch(n){if("EAGAIN"===n.code&&i<10){i++;continue}throw n}};