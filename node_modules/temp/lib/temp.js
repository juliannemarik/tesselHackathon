var r=require("fs"),e=require("osenv"),n=require("path"),t=require("constants"),i=t.O_CREAT|t.O_TRUNC|t.O_RDWR|t.O_EXCL,o=function(r,e){var t=f(r,e),i=new Date,o=""+t.prefix+i.getYear()+i.getMonth()+i.getDate()+"-"+process.pid+"-"+(4294967296*Math.random()+1).toString(36)+t.suffix;return n.join(t.dir||exports.dir,o)},f=function(r,e){var n={prefix:null,suffix:null};if(r)switch(typeof r){case"string":n.prefix=r;break;case"object":n=r;break;default:throw"Unknown affix declaration: "+n}else n.prefix=e;return n},u=!1,s=!1,a=[],c=[],p=function(r){if(!u)return!1;m(),a.push(r)},d=function(r){if(!u)return!1;m(),c.push(r)},m=function(){if(!u)return!1;s||(process.addListener("exit",x),s=!0)},x=function(){return!!u&&(fileCount=function(){var e,n;if(!u)return!1;for(e={removed:0,missing:0};n=a.shift();)try{r.unlinkSync(n),e.removed++}catch(r){e.missing++}return e}(),dirCount=function(){var r,e,n;if(!u)return!1;for(r=require("rimraf").sync,e={removed:0,missing:0};n=c.shift();)try{r(n,function(r){if(r)throw r;e.removed++})}catch(r){e.missing++}return e}(),{files:fileCount,dirs:dirCount})};exports.dir=n.resolve(e.tmpdir()),exports.track=function(r){u=0!=r},exports.mkdir=function(e,n){var t=o(e,"d-");r.mkdir(t,448,function(r){r||d(t),n&&n(r,t)})},exports.mkdirSync=function(e){var n=o(e,"d-");return r.mkdirSync(n,448),d(n),n},exports.open=function(e,n){var t=o(e,"f-");r.open(t,i,384,function(r,e){r||p(t),n&&n(r,{path:t,fd:e})})},exports.openSync=function(e){var n=o(e,"f-"),t=r.openSync(n,i,384);return p(n),{path:n,fd:t}},exports.path=o,exports.cleanup=x,exports.createWriteStream=function(e){var n=o(e,"s-"),t=r.createWriteStream(n,{flags:i,mode:384});return p(n),t};